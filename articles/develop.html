<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Developing rirods â€¢ rirods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Developing rirods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rirods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/demo.html">Use iRODS demo</a></li>
    <li><a class="dropdown-item" href="../articles/develop.html">Developing rirods</a></li>
    <li><a class="dropdown-item" href="../articles/icommands.html">rirods vs iCommands</a></li>
    <li><a class="dropdown-item" href="../articles/local-irods.html">Accessing data locally and in iRODS</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Use iRODS metadata</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-2-0/">Version 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-1-1/">Version 0.1.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/irods/irods_client_library_rirods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Developing rirods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/irods/irods_client_library_rirods/blob/dev/vignettes/develop.Rmd" class="external-link"><code>vignettes/develop.Rmd</code></a></small>
      <div class="d-none name"><code>develop.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="contributing-to-rirods-development">Contributing to rirods development<a class="anchor" aria-label="anchor" href="#contributing-to-rirods-development"></a>
</h2>
<p>To contribute to <a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> fork the source files from: <a href="https://github.com/irods/irods_client_library_rirods" class="external-link uri">https://github.com/irods/irods_client_library_rirods</a>,
and make a Pull Request.</p>
</div>
<div class="section level2">
<h2 id="prerequisites-r">Prerequisites R<a class="anchor" aria-label="anchor" href="#prerequisites-r"></a>
</h2>
<p>The following R packages are furthermore required for development:
<code>xml2</code>, <code>purrr</code>, <code>readr</code>,
<code>testthat</code> (&gt;= 3.0.0), <code>knitr</code>,
<code>rmarkdown</code>, <code>spelling</code>, <code>kableExtra</code>,
and <code>httptest2</code>. For convenience, one can also use
<code>renv</code> () and <code><a href="https://rstudio.github.io/renv/reference/restore.html" class="external-link">renv::restore()</a></code> to install all
dependencies. The <code>usethis</code> and the <code>devtools</code>
packages are further suggestions to streamline development. See <a href="https://devtools.r-lib.org/" class="external-link">devtools</a> and <a href="https://usethis.r-lib.org/" class="external-link">usethis</a> for common development
tasks and setups covered by these packages.</p>
<p>Development of <code>rirods</code> relies on the
<code>httptest2</code> which enables testing of the logic on the R side
of the API without requiring access to the remote service. It does this
by recording the API response as mock files. These mock files are stored
in several directories under <code>tests/testthat/</code>.</p>
</div>
<div class="section level2">
<h2 id="prerequisites-irods">Prerequisites iRODS<a class="anchor" aria-label="anchor" href="#prerequisites-irods"></a>
</h2>
<p>The unit test included in the source files can either be run against
a local or remote iRODS C++ HTTP API service - <a href="https://github.com/irods/irods_client_http_api" class="external-link uri">https://github.com/irods/irods_client_http_api</a>.</p>
<div class="section level3">
<h3 id="local-server">Local server<a class="anchor" aria-label="anchor" href="#local-server"></a>
</h3>
<p>Launch a local demonstration iRODS service (including the HTTP
API):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># clone the repository (and submodule "irods_demo")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># or use `git submodule update --init` when already cloned without submodules</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--recurse-submodules</span> https://github.com/irods/irods_demo</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># start the REST API</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="bu">cd</span> irods_demo</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span> nginx-reverse-proxy irods-client-http-api irods-client-icommands</span></code></pre></div>
<p>Alternatively, one can use the R function
<code><a href="../reference/use_irods_demo.html">use_irods_demo()</a></code>.</p>
<p>Note, that both options can only be used if Docker and the
Docker-compose plugin are installed.</p>
<p>This will result in the demonstration HTTP API running at <a href="http://localhost:9001/irods-http-api/0.5.0" class="external-link uri">http://localhost:9001/irods-http-api/0.5.0</a> (or later
version). No further configuration in R is needed for development
(except for removing possible mock files). For example, to run the unit
tests against this local server use: <code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test()</a></code>.</p>
<p>For miscellaneous development tasks one can, furthermore, use:
<code><a href="https://usethis.r-lib.org/reference/proj_utils.html" class="external-link">usethis::local_project</a></code>. This test fixture uses an
alternative directory as the working directory thereby preventing
cluttering of the package source files (defaults to a temporary
directory). The working directory can be restored to the package
directory by restarting the R session (possibly with
<code>CTRL + SHIFT + F10</code>) or by running
<code><a href="https://withr.r-lib.org/reference/defer.html" class="external-link">withr::deferred_run()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="remote-server">Remote server<a class="anchor" aria-label="anchor" href="#remote-server"></a>
</h3>
<p>Testing against a remote server requires the specification of server
information. This information needs to be entered in the
<code>.Rprofile</code> file:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dependency management</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>renv.settings.snapshot.type <span class="op">=</span> <span class="st">"explicit"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"renv/activate.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># development key (create key with httr2::secret_make_key() and place in user</span></span>
<span><span class="co"># level environment variables. One can use usethis::edit_r_environ() for this.</span></span>
<span><span class="co"># Store the key under "DEV_KEY_IRODS")</span></span>
<span></span>
<span><span class="co"># iRODS environment variables for development</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>DEV_HOST_IRODS <span class="op">=</span> <span class="st">"nLO8T0IpHCT2kXklYE-IB0HjYpNkg5wN4ZKk7TPSvkwGf9FauDR-O5mVI-mmD2_zNFGLoaVcAgYl"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>DEV_USER <span class="op">=</span> <span class="st">"ZGlORquE2G6BIPS5JAcuPcngmBB6Wg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>DEV_PASS <span class="op">=</span> <span class="st">"ZGlORquE2G6BIPS5JAcuPcngmBB6Wg"</span><span class="op">)</span></span></code></pre></div>
<p>The server information is stored in the environmental variables
<code>DEV_HOST_IRODS</code> , <code>DEV_USER</code>, and
<code>DEV_PASS</code>. Server information is provided in scrambled
format to prevent leakage of sensitive information to GitHub.</p>
<p>The following step are needed to scramble this information.</p>
<ol style="list-style-type: decimal">
<li>Generate package development key:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/secrets.html" class="external-link">secret_make_key</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Store the package development key as an environmental variable at
the user level. For convenience one can use
<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> which opens the
<code>.Renviron</code> file. Enter your key by replacing
<code>&lt;key&gt;</code> as follows:</li>
</ol>
<pre><code><span><span class="va">DEV_KEY_IRODS</span><span class="op">=</span><span class="st">"&lt;key&gt;"</span></span></code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Scramble the iRODS server information with
<code><a href="https://httr2.r-lib.org/reference/secrets.html" class="external-link">httr2::secret_encrypt()</a></code>. For example, scramble the host
name as follows:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/secrets.html" class="external-link">secret_encrypt</a></span><span class="op">(</span><span class="st">"http://localhost:9001/irods-http-api/0.1.0"</span> ,<span class="st">"DEV_KEY_IRODS"</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><p>Store the scrambled information at the designated places in the
project level <code>.Rprofile</code>: host name under
<code>DEV_HOST_IRODS</code>, user name under <code>DEV_USER</code>, and
password under <code>DEV_PASS</code>.</p></li>
<li><p>Restart the R sessions (possibly with
<code>CTRL + SHIFT + F10</code>).</p></li>
</ol>
<p>Note that the unit tests are built against a clean server with only
one user (i.e., <code>DEV_USER</code>).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Schobben, Mariana Montes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
