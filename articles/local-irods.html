<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Accessing data locally and in iRODS • rirods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Accessing data locally and in iRODS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rirods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/demo.html">Use iRODS demo</a></li>
    <li><a class="dropdown-item" href="../articles/develop.html">Developing rirods</a></li>
    <li><a class="dropdown-item" href="../articles/icommands.html">rirods vs iCommands</a></li>
    <li><a class="dropdown-item" href="../articles/local-irods.html">Accessing data locally and in iRODS</a></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Use iRODS metadata</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-2-0/">Version 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-1-1/">Version 0.1.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/irods/irods_client_library_rirods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Accessing data locally and in iRODS</h1>
                        <h4 data-toc-skip class="author">Mariana
Montes</h4>
            
            <h4 data-toc-skip class="date">2024-09-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/irods/irods_client_library_rirods/blob/dev/vignettes/local-irods.Rmd" class="external-link"><code>vignettes/local-irods.Rmd</code></a></small>
      <div class="d-none name"><code>local-irods.Rmd</code></div>
    </div>

    
    
<p>If you are not familiar with iRODS, understanding how to access and
manipulate data with it may be less than intuitive. In this vignette,
we’ll go through the main functions for setting and changing the working
directory and for creating, saving, reading and removing data, comparing
R functions for manipulation of local files and the
<a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> counterparts.</p>
<p>The main point to understand is that the iRODS server is not simply
another location that you can access by editing a path. While you can
use <code><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove()</a></code> to remove any file in your computer,
there is no path you can provide that will remove a data object in
iRODS. Instead, you need to use <code><a href="../reference/irm.html">irm()</a></code>, which connects to
the iRODS server to apply the same action. This is the sort of
comparison we will see in this vignette.</p>
<p>A second point to keep in mind is that, normally, you need to stage
and unstage your data in order to manipulate it, rather than modifying
your iRODS data directly. This is always the case with other clients,
such as iCommands: if you want to read a dataframe you have in iRODS,
you first need to copy it to your local computer and then open
<em>that</em> file; if you want to save a modified version of that file
you have to copy the local (modified) version back to iRODS.
<a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> offers one exception to this by allowing to save R
objects in RDS format (only) directly into iRODS and read them back,
with <code><a href="../reference/iput.html">isaveRDS()</a></code> and <code><a href="../reference/iget.html">ireadRDS()</a></code>
respectively.</p>
<p>Finally, most of the functions in <a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> are inspired
by iCommands, which are themselves modelled after Unix commands and
prefixed by an <code>i</code>. So, for example, the Unix command to
<strong>c</strong>hange a <strong>d</strong>irectory is <code>cd</code>,
its iCommands counterpart is <code>icd</code>, and then the
<a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> equivalent is <code><a href="../reference/icd.html">icd()</a></code>.</p>
<div class="section level2">
<h2 id="set-and-change-working-directory">Set and change working directory<a class="anchor" aria-label="anchor" href="#set-and-change-working-directory"></a>
</h2>
<p>In R we can check the working directory with <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> and
change it with <code>setwd(dir)</code>, where <code>dir</code> is the
path we want to set as the new working directory. Both functions return
the current working directory; before the change and invisibly in the
case of <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code>.</p>
<p>The <a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> counterparts are <code><a href="../reference/icd.html">ipwd()</a></code>
(“print working directory”) and <code>icd(dir)</code> (“change
directory”) respectively.</p>
<p>For the purposes of this vignette, we’ll use a temporary directory
locally. This is the current output of <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> and
<code><a href="../reference/icd.html">ipwd()</a></code> respectively:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/icd.html">ipwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can see their contents with <code>dir(path)</code> or
<code>list.files(path)</code> and <code>ils(path)</code> respectively.
If <code>path</code> is not provided, the current working directory is
used as default:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can focus on the “data” local directory with
<code>setwd("data")</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Which is &lt;a href="https://github.com/jennybc/here_here" class="external-link"&gt;not recommended&lt;/a&gt; in any
case.&lt;/p&gt;'><sup>1</sup></a> and on the “data” iRODS collection with
<code>icd("data")</code>. Then the output of <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> and
<code><a href="../reference/icd.html">ipwd()</a></code>, respectively, are updated, and <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir()</a></code>
and <code><a href="../reference/ils.html">ils()</a></code> will show the contents of “data” by default.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">old_irods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/icd.html">icd</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can reset our working directories by providing the old path to
<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code> and <code><a href="../reference/icd.html">icd()</a></code> respectively. Note that
moving upwards in the file system is also possible by providing “../”
for each level up you want to go: <code>icd("../")</code> changes the
iRODS working directory to its parent collection.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">old_local</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/icd.html">icd</a></span><span class="op">(</span><span class="va">old_irods</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/icd.html">ipwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-directories">Create directories<a class="anchor" aria-label="anchor" href="#create-directories"></a>
</h2>
<p>Directories can be created in R with <code>dir.create(path)</code>;
collections can be created in iRODS with <code>imkdir(path)</code>
(“<strong>m</strong>a<strong>k</strong>e <strong>dir</strong>ectory”),
providing a path relative to the working directory. For example, the
code below creates an “analysis” directory under our working directory,
first locally and then in iRODS.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/imkdir.html">imkdir</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-data">Save data<a class="anchor" aria-label="anchor" href="#save-data"></a>
</h2>
<p>R and several R packages (such as <a href="https://readr.tidyverse.org" class="external-link">readr</a>) provide a
number of functions to save data locally. For example,
<code>writeLines(some_vector, path)</code> can be used to write a vector
into a text file with one item per line;
<code>write.csv(dataframe, path)</code> can be used to write a dataframe
as a comma-separated file; <code>saveRDS(R_object, path)</code> can be
used to write any R object into an RDS file. This path can be relative
to the working directory or absolute paths.</p>
<p>For example, let’s simulate some data and store it in our “data”
directory with <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">fake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fake_data</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">fake_data</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">fake_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"data.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>When saving data in iRODS, we don’t have these kinds of options.
Instead, we can either transfer a file of any type from our local system
to iRODS with <code>iput(local_path, irods_path)</code> or save an R
object as an RDS file with
<code>isaveRDS(some_object, irods_path)</code>. In the case of our
simulated data, we use the first option:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iput.html">iput</a></span><span class="op">(</span><span class="st">"data/data.csv"</span>, <span class="st">"data/data_from_local.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>Note that the file name need not stay the same in the local and iRODS
systems. Now, let’s say that we have processed our data with some linear
regression modelling.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">fake_data</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre></div>
<p>We could certainly store the output locally, but we could also decide
to only store it in iRODS if we save it in RDS format. So let’s save it
in the “analysis” collection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iput.html">isaveRDS</a></span><span class="op">(</span><span class="va">m</span>, <span class="st">"analysis/linear_model.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span> <span class="co"># nothing was saved locally</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-data">Read data<a class="anchor" aria-label="anchor" href="#read-data"></a>
</h2>
<p>Just like we have many different R functions to save files to
different formats, there are specific functions to read files in
different formats. And just like with <a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> we either
save in RDS format or transfer files from a local system to iRODS, we
either read RDS files or transfer files back from iRODS to the local
system. If we want to read “data_from_local.csv”, we first need to
retrieve it with <code>iget(irods_path, local_path)</code> and then open
it with an appropriate R function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iget.html">iget</a></span><span class="op">(</span><span class="st">"data/data_from_local.csv"</span>, <span class="st">"data/data_from_irods.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/data_from_irods.csv"</span><span class="op">)</span> <span class="co"># same as fake_data</span></span></code></pre></div>
<p>For the RDS files, we could also use <code><a href="../reference/iget.html">iget()</a></code> if we wanted
to store them locally, or simply <code>ireadRDS(irods_path)</code> to
read the file directly.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy locally first</span></span>
<span><span class="fu"><a href="../reference/iget.html">iget</a></span><span class="op">(</span><span class="st">"analysis/linear_model.rds"</span>, <span class="st">"analysis/linear_model_in_local.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"analysis/linear_model_in_local.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or read directly from iRODS</span></span>
<span><span class="fu"><a href="../reference/iget.html">ireadRDS</a></span><span class="op">(</span><span class="st">"analysis/linear_model.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="remove-data">Remove data<a class="anchor" aria-label="anchor" href="#remove-data"></a>
</h2>
<p>Finally, local data can be removed with <code>unlink(path)</code> or
<code><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove()</a></code>, whereas iRODS data can be
<strong>r</strong>e<strong>m</strong>oved with <code>irm(path)</code>.
Both <code><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink()</a></code> and <code><a href="../reference/irm.html">irm()</a></code> take an optional
argument <code>recursive</code> that should be <code>TRUE</code> if we
want to remove a directory/collection and all its contents. In the case
of <code><a href="../reference/irm.html">irm()</a></code>, the <code>force</code> argument also defines
whether the item should be deleted permanently or, if
<code>FALSE</code>, sent to the “trash” collection.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"analysis"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/irm.html">irm</a></span><span class="op">(</span><span class="st">"data"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Schobben, Mariana Montes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
